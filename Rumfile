#!/usr/bin/env ruby
gem = Gem::Specification::load("rumrunner.gemspec")
pkg = "pkg/#{gem.full_name}.gem"

repo :rum, name: "docker.io/amancevice/rumrunner", tag: "1.0", iidpath: ".docker" do |c|
  env :RUBY => "2.7"

  stage :lock
  stage :test => :lock
  stage :gem => :test

  # export "Gemfile.lock" => :lock
  # export pkg => :build
end

task :gem => pkg

namespace :gem do
  desc "Push `#{pkg}` to rubygems.org"
  task :push => pkg do
    sh "gem push #{pkg}"
  end
end
