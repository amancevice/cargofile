#!/usr/bin/env ruby
gem = Gem::Specification::load "rumrunner.gemspec"
pkg = "pkg/#{gem.full_name}.gem"

namespace :rum do
  dockerfile "Dockerfile"
  context "."
  repo "docker.io/amancevice/rumrunner"

  env :RUBY => "2.7"

  stage :lock
  stage :test => :lock
  stage :gem => :test

  export :lock => "Gemfile.lock"
  export :build => pkg
end

namespace :gem do
  desc "Push `#{pkg}` to rubygems.org"
  task :push => pkg do
    sh "gem push #{pkg}"
  end
end

task :gem => pkg
