#!/usr/bin/env ruby

require "cargofile"
require "pry"

cargo :cargofile do

  image tag: %x(git describe --tags --always).strip

  build_arg RUNTIME: "ruby2.5"

  target :build

  target :test

  target :plan do
    build_arg :AWS_ACCESS_KEY_ID
    build_arg :AWS_DEFAULT_REGION
    build_arg :AWS_SECRET_ACCESS_KEY
    # shell "/bin/sh"
  end

  artifact "pkg/vendor.zip" => :build do
    workdir "/var/task"
    cmd     %w{cat vendor.zip}
  end

  artifact "Gemfile.lock" => :build
end
